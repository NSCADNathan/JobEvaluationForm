<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NSCAD Unit II Evaluator (Member Edition)</title>
<style>
    :root{--bg:#f8f9fa; --card:#ffffff; --text:#212529; --mute:#6c757d; --pri:#5e35b1; --acc:#d81b60; --border:#dee2e6; --sel:#ede7f6;}
    body{font-family:'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background:var(--bg); color:var(--text); margin:0; padding-bottom:120px; line-height:1.6;}
    header{background:#fff; border-bottom:3px solid var(--pri); padding:15px 20px; display:flex; align-items:center; justify-content:space-between; position:sticky; top:0; z-index:100; box-shadow:0 4px 6px -1px rgba(0,0,0,0.1);}
    h1{margin:0; font-size:1.25rem; text-transform:uppercase; color:var(--pri); letter-spacing:0.5px; font-weight:800;}
    .action-btn{background:white; border:1px solid #ced4da; color:#495057; padding:6px 12px; cursor:pointer; font-size:0.85rem; border-radius:4px; font-weight:600; transition:all 0.2s;}
    .action-btn:hover{background:#e9ecef;}
    .container{max-width:900px; margin:30px auto; padding:0 15px;}
    .card{background:var(--card); border-radius:8px; padding:30px; border:1px solid var(--border); box-shadow:0 2px 4px rgba(0,0,0,0.05); margin-bottom:20px;}

    /* INPUTS */
    .details-grid {display:grid; grid-template-columns: 1fr 1fr; gap:20px; margin-bottom:15px;}
    .input-group {margin-bottom:15px;}
    .input-label {display:block; font-size:0.75rem; font-weight:700; color:var(--mute); margin-bottom:6px; text-transform:uppercase;}
    .input-field {width:100%; padding:10px; border:1px solid #ced4da; border-radius:4px; font-size:1rem; box-sizing:border-box;}

    /* ACCORDION NOTES */
    .note-accordion {margin-bottom: 20px; border: 1px solid var(--border); border-radius: 6px; background: #fdfdfd; overflow: hidden;}
    .note-accordion summary {padding: 12px; font-size: 0.85rem; font-weight: 700; color: var(--pri); cursor: pointer; list-style: none; display: flex; align-items: center; background: #fcfaff;}
    .note-accordion summary::before {content: 'â–¶'; display: inline-block; margin-right: 10px; transition: transform 0.2s; font-size: 0.7rem;}
    .note-accordion[open] summary::before {transform: rotate(90deg);}
    .note-content {padding: 15px; border-top: 1px solid var(--border); background: white;}
    .rationale-text {width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 4px; font-family: 'Georgia', serif; font-size: 0.95rem; resize: vertical; box-sizing: border-box;}

    /* FACTORS */
    .factor-header{border-bottom:2px solid var(--pri); margin-bottom:20px; padding-bottom:15px; display:flex; justify-content:space-between; align-items:center;}
    .factor-title{font-size:1.5rem; font-weight:800; color:var(--text); margin:0;}
    .opt-item{border:1px solid var(--border); border-radius:6px; padding:15px; cursor:pointer; background:white; transition:all 0.2s; margin-bottom:10px;}
    .opt-item.selected{border-color:var(--pri); background:var(--sel); border-left:5px solid var(--pri);}
    .opt-name{font-weight:700; font-size:1.05rem; color:var(--pri);}
    .opt-score{background:var(--text); color:white; padding:2px 8px; border-radius:10px; font-weight:700; font-size:0.8rem;}

    footer{position:fixed; bottom:0; left:0; width:100%; background:white; border-top:1px solid var(--border); padding:15px 0; z-index:200;}
    .footer-inner{max-width:900px; margin:0 auto; padding:0 15px; display:flex; justify-content:space-between; align-items:center;}
    .stat-num{font-size:1.4rem; font-weight:800;}
</style>
</head>
<body>

<header>
    <h1>Unit II Evaluator</h1>
    <div class="header-controls">
        <button class="action-btn" onclick="document.getElementById('fileInput').click()">ðŸ“‚ Load .nate</button>
        <button class="action-btn" style="border-color:var(--pri); color:var(--pri);" onclick="exportData()">ðŸ’¾ Save .nate</button>
        <input type="file" id="fileInput" accept=".nate" style="display:none" onchange="importData(this)">
    </div>
</header>

<div class="container" id="app-content"></div>

<footer>
    <div class="footer-inner">
        <div style="display:flex; gap:30px;">
            <div><span style="font-size:0.7rem; text-transform:uppercase; color:var(--mute); font-weight:700;">Total Points</span><br><span class="stat-num" id="totalPoints">0</span></div>
            <div><span style="font-size:0.7rem; text-transform:uppercase; color:var(--mute); font-weight:700;">Est. Group</span><br><span class="stat-num" id="payGroup">-</span></div>
        </div>
        <div>
            <button class="action-btn" onclick="prevStep()">Back</button>
            <button class="action-btn" style="background:var(--pri); color:white; padding-left:25px; padding-right:25px;" onclick="nextStep()">Next</button>
        </div>
    </div>
</footer>

<script>
const factors = [
    {id:'edu', t:'1. Education', opts:[{p:13,t:"Degree 1",d:"Undergraduate Degree or equivalent."},{p:26,t:"Degree 2",d:"Undergraduate degree in specific skilled area or equivalent."},{p:39,t:"Degree 3",d:"Graduate degree in specific skilled area or equivalent."}]},
    {id:'exp', t:'2. Experience', opts:[{p:20,t:"Degree 1",d:"Up to 2 years related experience."},{p:40,t:"Degree 2",d:"3 to 4 years related experience."},{p:60,t:"Degree 3",d:"5+ years related experience."}]},
    {id:'comp', t:'3. Complexity/Judgement', opts:[{p:25,t:"Degree 1",d:"Limited analysis. Assignments are standardized."},{p:50,t:"Degree 2",d:"Moderate degree of analysis."},{p:75,t:"Degree 3",d:"Interpretative skill. Situations are diverse."},{p:100,t:"Degree 4",d:"Complex and highly developed analysis (new technologies)."}]},
    {id:'resp', t:'4. Responsibility', opts:[{p:18,t:"Degree 1",d:"Overseeing department policies during shift."},{p:36,t:"Degree 2",d:"Full range of duties for limited access area."},{p:54,t:"Degree 3",d:"Responsibility for limited aspect of open access area."},{p:71,t:"Degree 4",d:"Full range of duties for open access area."},{p:89,t:"Degree 5",d:"Oversees complete department or specialized function."},{p:107,t:"Degree 6",d:"Oversees complete department with multiple functions/small budget."},{p:125,t:"Degree 7",d:"Management of significant department and large budget."}]},
    {id:'supO', t:'5. Supervision Given', opts:[{p:18,t:"Degree 1",d:"No supervision. Monitoring SAs only."},{p:36,t:"Degree 2",d:"Monitoring/training 1-4 SAs."},{p:54,t:"Degree 3",d:"Supervision of 5+ SAs OR recruiting/training SAs."}]},
    {id:'supR', t:'6. Supervision Rec\'d', opts:[{p:15,t:"Degree 1",d:"Supervisor available daily."},{p:30,t:"Degree 2",d:"Supervisor available for majority of tasks, not specialty."},{p:45,t:"Degree 3",d:"No daily access to supervisor. Prioritizing required."},{p:60,t:"Degree 4",d:"Prioritizing necessary on a regular basis."},{p:75,t:"Degree 5",d:"Works without supervision. Sets policy."}]},
    {id:'inst', t:'13. Instruction Delivery', opts:[{p:25,t:"Degree 1",d:"Basic instructions on proper use of area."},{p:50,t:"Degree 2",d:"One-on-one assistance with techniques."},{p:75,t:"Degree 3",d:"Full class or one-on-one instruction."},{p:100,t:"Degree 4",d:"Instruction for complex procedures. Documentation provided."}]}
];

let cur = 0, scores = {}, rationales = {}, userData = { name: "", position: "", date: new Date().toLocaleDateString() };

function render() {
    let el = document.getElementById('app-content');
    if (cur >= factors.length) { renderSummary(el); return; }

    let f = factors[cur];
    let headerHtml = (cur === 0) ? `
        <div class="card">
            <h3 style="margin-top:0; color:var(--pri);">Employee Details</h3>
            <div class="details-grid">
                <div class="input-group"><label class="input-label">Name</label><input type="text" class="input-field" value="${userData.name}" oninput="userData.name=this.value"></div>
                <div class="input-group"><label class="input-label">Date</label><input type="text" class="input-field" value="${userData.date}" disabled></div>
            </div>
            <div class="input-group"><label class="input-label">Position Title</label><input type="text" class="input-field" value="${userData.position}" oninput="userData.position=this.value" placeholder="e.g. Textiles Technician"></div>
        </div>` : "";

    el.innerHTML = headerHtml + `
        <div class="card">
            <div class="factor-header"><div class="factor-title">${f.t}</div></div>
            <details class="note-accordion" ${rationales[f.id] ? 'open' : ''}>
                <summary>Evidence & Rationale</summary>
                <div class="note-content"><textarea class="rationale-text" rows="4" oninput="rationales['${f.id}']=this.value" placeholder="Document duties that justify this degree...">${rationales[f.id] || ''}</textarea></div>
            </details>
            <div class="options-list">${f.opts.map(o => `<div class="opt-item ${scores[f.id] === o.p ? 'selected' : ''}" onclick="sel('${f.id}',${o.p})"><div style="display:flex; justify-content:space-between;"><span class="opt-name">${o.t}</span><span class="opt-score">${o.p} pts</span></div><div class="opt-desc">${o.d}</div></div>`).join('')}</div>
        </div>`;
    updateUI();
}

function sel(id, p) { scores[id] = p; render(); }
function updateUI() {
    let t = Object.values(scores).reduce((a, b) => a + b, 0);
    document.getElementById('totalPoints').innerText = t;
    document.getElementById('payGroup').innerText = getG(t);
}
function getG(t) { if (t >= 711) return "Group 7"; if (t >= 661) return "Group 6"; if (t >= 611) return "Group 5"; if (t >= 561) return "Group 4"; if (t >= 511) return "Group 3"; return "Group 1/2"; }
function nextStep() { cur++; render(); }
function prevStep() { if(cur > 0) { cur--; render(); } }

function renderSummary(el) {
    let t = Object.values(scores).reduce((a, b) => a + b, 0);
    let rows = factors.map(f => `<tr><td>${f.t}</td><td>${scores[f.id] || 0}</td><td>${rationales[f.id] || '<em>No notes</em>'}</td></tr>`).join('');
    el.innerHTML = `<div class="card"><h2>Evaluation Summary for ${userData.name || 'Member'}</h2><p>Position: ${userData.position}<br>Est. Group: <strong>${getG(t)}</strong></p><table style="width:100%; border-collapse:collapse;"><thead><tr style="text-align:left; border-bottom:2px solid var(--pri);"><th>Factor</th><th>Pts</th><th>Rationale</th></tr></thead><tbody>${rows}</tbody></table><br><button class="action-btn" onclick="window.print()">Print Final Report</button></div>`;
}

function exportData() {
    let blob = new Blob([JSON.stringify({ scores, rationales, userData })], {type: "text/plain"});
    let a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download = `NSCAD_Eval_${userData.name || 'Member'}.nate`; a.click();
}

function importData(input) {
    let reader = new FileReader(); reader.onload = (e) => {
        let d = JSON.parse(e.target.result); scores = d.scores || {}; rationales = d.rationales || {}; userData = d.userData || userData; cur = 0; render();
    }; reader.readAsText(input.files[0]);
}
render();
</script>
</body>
</html>
