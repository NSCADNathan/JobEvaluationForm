<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NSCAD Unit II Evaluator (Member Edition)</title>
<style>
    :root{--bg:#f8f9fa; --card:#ffffff; --text:#212529; --mute:#6c757d; --pri:#5e35b1; --acc:#d81b60; --border:#dee2e6; --sel:#ede7f6;}
    body{font-family:'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background:var(--bg); color:var(--text); margin:0; padding-bottom:120px; line-height:1.6;}
    
    header{background:#fff; border-bottom:3px solid var(--pri); padding:15px 20px; display:flex; align-items:center; justify-content:space-between; position:sticky; top:0; z-index:100; box-shadow:0 4px 6px -1px rgba(0,0,0,0.1);}
    h1{margin:0; font-size:1.25rem; text-transform:uppercase; color:var(--pri); letter-spacing:0.5px; font-weight:800;}
    
    .header-controls{display:flex; gap:8px;}
    .action-btn{background:white; border:1px solid #ced4da; color:#495057; padding:6px 12px; cursor:pointer; font-size:0.85rem; border-radius:4px; font-weight:600; transition:all 0.2s; display:flex; align-items:center; gap:6px; white-space:nowrap;}
    .action-btn:hover{background:#e9ecef; transform:translateY(-1px);}
    .reset-btn{border-color:#c62828; color:#c62828;}
    .reset-btn:hover{background:#ffebee;}

    .container{max-width:900px; margin:30px auto; padding:0 15px;}
    .card{background:var(--card); border-radius:8px; padding:30px; border:1px solid var(--border); box-shadow:0 2px 4px rgba(0,0,0,0.05); margin-bottom:20px;}

    /* PROFILE FORMATTING */
    .profile-header { display: flex; align-items: center; gap: 20px; margin-bottom: 20px; padding-bottom: 20px; border-bottom: 1px solid var(--border); }
    .profile-icon { background: var(--sel); color: var(--pri); width: 60px; height: 60px; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 1.5rem; font-weight: 800; border: 2px solid var(--pri); }
    .details-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
    .input-group { margin-bottom: 15px; }
    .input-label { display: block; font-size: 0.7rem; font-weight: 800; color: var(--mute); margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; }
    .input-field { width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 6px; font-size: 1rem; color: var(--text); box-sizing: border-box; background: #fff; }

    /* FACTOR STYLES */
    .factor-header { border-bottom: 2px solid var(--pri); margin-bottom: 20px; padding-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
    .factor-title { font-size: 1.5rem; font-weight: 800; color: var(--text); margin: 0; }
    .guide-btn { background: white; color: var(--pri); border: 1px solid var(--pri); padding: 6px 14px; border-radius: 20px; font-weight: 700; font-size: 0.85rem; cursor: pointer; }

    .opt-item { border: 1px solid var(--border); border-radius: 6px; padding: 15px; cursor: pointer; background: white; transition: 0.2s; margin-bottom: 10px; }
    .opt-item.selected { border-color: var(--pri); background: var(--sel); border-left: 6px solid var(--pri); }
    .opt-head { display: flex; justify-content: space-between; align-items: baseline; margin-bottom: 6px; }
    .opt-name { font-weight: 700; font-size: 1.05rem; color: var(--pri); }
    .opt-score { background: var(--text); color: white; padding: 2px 8px; border-radius: 10px; font-weight: 700; font-size: 0.8rem; }
    .opt-desc { font-size: 0.95rem; color: #495057; }

    /* ACCORDION STYLES */
    .rationale-accordion { margin-top: 15px; border: 1px solid var(--border); border-radius: 6px; background: #fdfdfd; }
    .rationale-accordion summary { padding: 12px; font-size: 0.85rem; font-weight: 700; color: var(--pri); cursor: pointer; list-style: none; display: flex; align-items: center; }
    .rationale-accordion summary::before { content: 'â–¶'; display: inline-block; margin-right: 10px; transition: transform 0.2s; font-size: 0.7rem; }
    .rationale-accordion[open] summary::before { transform: rotate(90deg); }
    .rationale-content { padding: 0 15px 15px 15px; border-top: 1px solid var(--border); padding-top: 15px; }
    .rationale-text { width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 4px; font-family: 'Georgia', serif; font-size: 1rem; resize: vertical; box-sizing: border-box; }

    /* FOOTER & NAV */
    footer { position: fixed; bottom: 0; left: 0; width: 100%; background: white; border-top: 1px solid var(--border); padding: 15px 0; z-index: 200; box-shadow: 0 -4px 10px rgba(0,0,0,0.05); }
    .footer-inner { max-width: 900px; margin: 0 auto; padding: 0 15px; display: flex; justify-content: space-between; align-items: center; flex-wrap: nowrap; }
    .nav-btns { display: flex; flex-direction: row; gap: 10px; align-items: center; }
    .stat-num { font-size: 1.4rem; font-weight: 800; }
    .pay-group-display { color: var(--pri); font-weight: 800; text-decoration: underline; cursor: pointer; }

    /* MODAL STYLES */
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(3px); }
    .modal-content { background: white; width: 90%; max-width: 850px; max-height: 85vh; border-radius: 12px; display: flex; flex-direction: column; overflow: hidden; }
    .modal-header { padding: 20px; background: var(--bg); border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; }
    .modal-body { padding: 30px; overflow-y: auto; white-space: pre-wrap; font-family: 'Georgia', serif; font-size: 1rem; line-height: 1.6; }

    .salary-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; font-family: sans-serif; }
    .salary-table th, .salary-table td { border: 1px solid var(--border); padding: 8px; text-align: center; }
    .salary-table th { background: var(--text); color: white; }

    .summary-table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    .summary-table th { border-bottom: 2px solid var(--pri); padding: 10px; text-align: left; color: var(--pri); font-size: 0.8rem; text-transform: uppercase; }
    .summary-table td { border-bottom: 1px solid var(--border); padding: 15px 10px; vertical-align: top; }
    .summary-evidence { font-family: 'Georgia', serif; font-size: 0.9rem; color: #444; background: #fcfcfc; padding: 8px; border-radius: 4px; border-left: 3px solid var(--border); }

    @media print {
        header, footer, .guide-btn, .header-controls, .rationale-accordion summary { display: none !important; }
        .rationale-accordion { border: none; background: none; }
        .card { border: none; box-shadow: none; padding: 0; }
    }
</style>
</head>
<body>

<header>
    <h1>Unit II Evaluator</h1>
    <div class="header-controls">
        <button class="action-btn" onclick="document.getElementById('fileInput').click()">ðŸ“‚ Load .nate</button>
        <button class="action-btn" onclick="exportData()" style="color:var(--pri); border-color:var(--pri);">ðŸ’¾ Save .nate</button>
        <button class="action-btn reset-btn" onclick="hardReset()">â†º Reset</button>
        <input type="file" id="fileInput" accept=".nate" style="display:none" onchange="importData(this)">
    </div>
</header>

<div class="container" id="app-content"></div>

<div class="modal-overlay" id="guideModal">
    <div class="modal-content">
        <div class="modal-header"><h2 id="modalTitle" style="margin:0; font-size:1.2rem;">Guidebook</h2><button onclick="closeModal('guideModal')" style="background:none; border:none; font-size:1.5rem; cursor:pointer;">&times;</button></div>
        <div class="modal-body" id="modalBody"></div>
    </div>
</div>

<div class="modal-overlay" id="salaryModal">
    <div class="modal-content">
        <div class="modal-header"><h2 style="margin:0; font-size:1.2rem;">Salary Grid (July 1, 2025)</h2><button onclick="closeModal('salaryModal')" style="background:none; border:none; font-size:1.5rem; cursor:pointer;">&times;</button></div>
        <div class="modal-body">
            <table class="salary-table">
                <thead><tr><th>Group</th><th>Step 1</th><th>Step 2</th><th>Step 3</th><th>Step 4</th><th>Step 5</th><th>Step 6</th><th>Step 7</th><th>Step 8</th></tr></thead>
                <tbody id="salaryBody"></tbody>
            </table>
            <p style="margin-top:15px; font-style:italic; font-size:0.8rem; color:var(--mute);">*Salary data from Appendix F (2025) [cite: 1758-1760].</p>
        </div>
    </div>
</div>

<footer>
    <div class="footer-inner">
        <div style="display:flex; gap:30px;">
            <div><span style="font-size:0.7rem; text-transform:uppercase; color:var(--mute); font-weight:800;">Total Points</span><br><span class="stat-num" id="totalPoints">0</span></div>
            <div><span style="font-size:0.7rem; text-transform:uppercase; color:var(--mute); font-weight:800;">Est. Group</span><br><span class="stat-num pay-group-display" id="payGroup" onclick="openSal()">-</span></div>
        </div>
        <div class="nav-btns">
            <button class="action-btn" onclick="prevStep()" id="btnBack">Back</button>
            <button class="action-btn" style="background:var(--pri); color:white;" onclick="nextStep()" id="btnNext">Next</button>
        </div>
    </div>
</footer>

<script>
const salaryMatrix = [
    {g:1, s:["$47,907","$49,621","$51,336","$53,051","$54,765","$56,480","-","-"]},
    {g:2, s:["$51,336","$53,051","$54,765","$56,480","$58,195","$59,909","$61,624","$63,339"]},
    {g:3, s:["$54,765","$56,480","$58,195","$59,909","$61,624","$63,339","$65,053","$66,768"]},
    {g:4, s:["$58,195","$59,909","$61,624","$63,339","$65,053","$66,768","$68,483","$70,197"]},
    {g:5, s:["$61,624","$63,339","$65,053","$66,768","$68,483","$70,197","$71,912","$73,627"]},
    {g:6, s:["$65,053","$66,768","$68,483","$70,197","$71,912","$73,627","$75,341","$77,056"]},
    {g:7, s:["$68,483","$70,197","$71,912","$73,627","$75,341","$77,056","$78,771","$80,485"]},
    {g:8, s:["$71,912","$73,627","$75,341","$77,056","$78,771","$80,485","$82,200","$83,915"]}
];

const factors = [
    {id:'edu', t:'1. Education', ft:`EDUCATION [cite: 1878-1889]\n\nDEGREE 3: Graduate degree in specific skilled area or equivalent.`, opts:[{p:13,t:"Degree 1",d:"Undergraduate Degree or equivalent."},{p:26,t:"Degree 2",d:"Undergraduate degree in specific skilled area."},{p:39,t:"Degree 3",d:"Graduate degree in specific skilled area."}]},
    {id:'exp', t:'2. Experience', ft:`EXPERIENCE [cite: 1892-1901]\n\nDEGREE 3: 5+ years related experience.`, opts:[{p:20,t:"Degree 1",d:"Up to 2 years related experience."},{p:40,t:"Degree 2",d:"3 to 4 years related experience."},{p:60,t:"Degree 3",d:"5+ years related experience."}]},
    {id:'comp', t:'3. Complexity/Judgement', ft:`COMPLEXITY  [cite: 1903-1958]\n\nDEGREE 4: Complex and highly developed analysis required as with new technologies.`, opts:[{p:25,t:"Degree 1",d:"Standardized assignments."},{p:50,t:"Degree 2",d:"Moderate analysis."},{p:75,t:"Degree 3",d:"Diverse situations."},{p:100,t:"Degree 4",d:"Complex/New Technologies."}]},
    {id:'resp', t:'4. Responsibility', ft:`RESPONSIBILITY\n\nDEGREE 6: Oversees complete departmental area or function with multiple functions.`, opts:[{p:18,t:"Degree 1",d:"Overseeing shift policies."},{p:36,t:"Degree 2",d:"Limited access area."},{p:54,t:"Degree 3",d:"Aspect of open access area."},{p:71,t:"Degree 4",d:"Full range open access."},{p:89,t:"Degree 5",d:"Oversees specialized function."},{p:107,t:"Degree 6",d:"Multiple functions."}]},
    {id:'supO', t:'5. Supervision Given', ft:`SUPERVISION [cite: 1878-1889]\n\nDEGREE 3: Supervision of 5+ SAs or training technicians.`, opts:[{p:18,t:"Degree 1",d:"No supervision."},{p:36,t:"Degree 2",d:"1-4 SAs."},{p:54,t:"Degree 3",d:"5+ SAs or training technicians."}]},
    {id:'inst', t:'13. Instruction Delivery', ft:`INSTRUCTION [cite: 1878-1889]\n\nDEGREE 4: Instruction on demand for complex procedures.`, opts:[{p:25,t:"Degree 1",d:"Basic instructions."},{p:50,t:"Degree 2",d:"One-on-one help."},{p:75,t:"Degree 3",d:"Full class instruction."},{p:100,t:"Degree 4",d:"Complex/On-demand."}]}
];

let cur = 0, scores = {}, rationales = {}, userData = { name: "", position: "", date: new Date().toLocaleDateString() };

window.onload = () => {
    let saved = localStorage.getItem('nscad_final_data');
    if (saved) {
        let p = JSON.parse(saved);
        scores = p.scores || {}; rationales = p.rationales || {}; userData = p.userData || userData;
    }
    render(); updateFooter();
};

function save() { localStorage.setItem('nscad_final_data', JSON.stringify({ scores, rationales, userData })); }

function render() {
    let el = document.getElementById('app-content');
    if (cur >= factors.length) { renderSummary(el); return; }

    let f = factors[cur];
    let profileHtml = (cur === 0) ? `
        <div class="card">
            <div class="profile-header"><div class="profile-icon">${userData.name ? userData.name[0].toUpperCase() : 'U'}</div><div><h2 style="margin:0; color:var(--pri);">Member Profile</h2><p style="margin:0; font-size:0.8rem; color:var(--mute);">Complete details to begin</p></div></div>
            <div class="details-grid">
                <div class="input-group"><label class="input-label">Technician Name</label><input type="text" class="input-field" value="${userData.name}" oninput="userData.name=this.value; save();" placeholder="Full Name"></div>
                <div class="input-group"><label class="input-label">Date</label><input type="text" class="input-field" value="${userData.date}" disabled></div>
            </div>
            <div class="input-group"><label class="input-label">Current Position</label><input type="text" class="input-field" value="${userData.position}" oninput="userData.position=this.value; save();" placeholder="e.g. Film Tech"></div>
        </div>` : "";

    el.innerHTML = profileHtml + `
    <div class="card">
        <div class="factor-header"><h2 class="factor-title">${f.t}</h2><button class="guide-btn" onclick="openGuide(${cur})">Guidebook Reference</button></div>
        <div class="options-list">${f.opts.map(o => `<div class="opt-item ${scores[f.id]===o.p?'selected':''}" onclick="setScore('${f.id}', ${o.p})"><div class="opt-head"><span class="opt-name">${o.t}</span><span class="opt-score">${o.p} pts</span></div><div class="opt-desc">${o.d}</div></div>`).join('')}</div>
        <details class="rationale-accordion" ${rationales[f.id] ? 'open' : ''}>
            <summary>Rationale & Evidence</summary>
            <div class="rationale-content"><textarea class="rationale-text" rows="4" oninput="rationales['${f.id}']=this.value; save();" placeholder="Enter evidence...">${rationales[f.id] || ''}</textarea></div>
        </details>
    </div>`;
    window.scrollTo(0,0);
}

function setScore(id, val) { scores[id] = val; save(); render(); updateFooter(); }
function calcT() { return Object.values(scores).reduce((a, b) => a + b, 0); }
function updateFooter() {
    let t = calcT(); document.getElementById('totalPoints').innerText = t;
    let g = "-";
    if (t >= 711) g = "Group 7"; else if (t >= 661) g = "Group 6"; else if (t >= 611) g = "Group 5"; else if (t >= 561) g = "Group 4"; else if (t >= 511) g = "Group 3";
    document.getElementById('payGroup').innerText = g;
}

function renderSummary(el) {
    let t = calcT();
    let rows = factors.map(f => `<tr><td><strong>${f.t}</strong></td><td style="text-align:center;">${scores[f.id]||0}</td><td><div class="summary-evidence">${rationales[f.id]||'No evidence'}</div></td></tr>`).join('');
    el.innerHTML = `<div class="card"><h2 style="color:var(--pri);">Evaluation Summary</h2><div style="background:var(--sel); border:2px solid var(--pri); padding:20px; border-radius:8px; text-align:center; margin-bottom:20px;"><div style="font-size:2.5rem; font-weight:800;">${t} Points</div><div style="font-size:1.5rem; font-weight:700; color:var(--pri);">${document.getElementById('payGroup').innerText}</div></div><table class="summary-table"><thead><tr><th>Factor</th><th style="text-align:center;">Pts</th><th>Evidence / Rationale</th></tr></thead><tbody>${rows}</tbody></table><br><button class="action-btn" onclick="window.print()" style="width:100%; justify-content:center;">Print Report</button></div>`;
}

function openGuide(i) { document.getElementById('modalTitle').innerText = factors[i].t; document.getElementById('modalBody').innerText = factors[i].ft; document.getElementById('guideModal').style.display='flex'; }
function closeModal(id) { document.getElementById(id).style.display='none'; }

function openSal() {
    let t = calcT();
    let currentGroup = 0;
    if (t >= 711) currentGroup = 7; else if (t >= 661) currentGroup = 6; else if (t >= 611) currentGroup = 5; else if (t >= 561) currentGroup = 4; else if (t >= 511) currentGroup = 3; else if (t >= 461) currentGroup = 2; else currentGroup = 1;

    let b = document.getElementById('salaryBody');
    b.innerHTML = "";
    salaryMatrix.forEach(r => {
        let h = `<tr style="${r.g === currentGroup ? 'background:var(--sel); font-weight:800; border:2px solid var(--pri);' : ''}"><td>Group ${r.g}</td>`;
        for (let i = 0; i < 8; i++) h += `<td>${r.s[i]}</td>`;
        b.innerHTML += h + `</tr>`;
    });
    document.getElementById('salaryModal').style.display='flex';
}

function nextStep() { if(cur<factors.length) { cur++; render(); } }
function prevStep() { if(cur>0) { cur--; render(); } }
function exportData() { let b = new Blob([JSON.stringify({ scores, rationales, userData })], {type:"text/plain"}); let a = document.createElement("a"); a.href=URL.createObjectURL(b); a.download=`Eval_${userData.name||'Member'}.nate`; a.click(); }
function importData(i) { let r = new FileReader(); r.onload=(e)=>{ let d=JSON.parse(e.target.result); scores=d.scores; rationales=d.rationales; userData=d.userData; cur=0; render(); updateFooter(); }; r.readAsText(i.files[0]); }
function hardReset() { if(confirm("Reset data?")) { localStorage.removeItem('nscad_final_data'); location.reload(); } }

render();
</script>
</body>
</html>
