<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NSCAD Unit II Evaluator</title>
<style>
    :root{--bg:#f8f9fa; --card:#ffffff; --text:#212529; --mute:#6c757d; --pri:#5e35b1; --acc:#d81b60; --border:#dee2e6; --sel:#ede7f6;}
    body{font-family:'Segoe UI', Roboto, Helvetica, Arial, sans-serif; background:var(--bg); color:var(--text); margin:0; padding-bottom:120px; line-height:1.6;}
    
    header{background:#fff; border-bottom:3px solid var(--pri); padding:15px 20px; display:flex; align-items:center; justify-content:space-between; position:sticky; top:0; z-index:100; box-shadow:0 4px 6px -1px rgba(0,0,0,0.1);}
    h1{margin:0; font-size:1.25rem; text-transform:uppercase; color:var(--pri); letter-spacing:0.5px; font-weight:800;}
    
    .header-controls{display:flex; gap:8px;}
    .action-btn{background:white; border:1px solid #ced4da; color:#495057; padding:6px 12px; cursor:pointer; font-size:0.85rem; border-radius:4px; font-weight:600; transition:all 0.2s; display:flex; align-items:center; gap:6px;}
    .action-btn:hover{background:#e9ecef;}

    .container{max-width:900px; margin:30px auto; padding:0 15px;}
    .card{background:var(--card); border-radius:8px; padding:30px; border:1px solid var(--border); box-shadow:0 2px 4px rgba(0,0,0,0.05); margin-bottom:20px;}

    .details-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
    .input-label { display: block; font-size: 0.7rem; font-weight: 800; color: var(--mute); margin-bottom: 5px; text-transform: uppercase; letter-spacing: 1px; }
    .input-field { width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 6px; font-size: 1rem; box-sizing: border-box; }

    .factor-header { border-bottom: 2px solid var(--pri); margin-bottom: 20px; padding-bottom: 15px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; }
    .factor-title { font-size: 1.5rem; font-weight: 800; color: var(--text); margin: 0; }
    
    .guide-btn { background: white; color: var(--pri); border: 1px solid var(--pri); padding: 6px 14px; border-radius: 20px; font-weight: 700; font-size: 0.8rem; cursor: pointer; margin-left: 8px; }
    .guide-btn.manual { border-color: var(--acc); color: var(--acc); }

    .opt-item { border: 1px solid var(--border); border-radius: 6px; padding: 15px; cursor: pointer; background: white; transition: 0.2s; margin-bottom: 10px; }
    .opt-item.selected { border-color: var(--pri); background: var(--sel); border-left: 6px solid var(--pri); }
    .opt-score { background: var(--text); color: white; padding: 2px 8px; border-radius: 10px; font-weight: 700; font-size: 0.8rem; float: right; }

    /* CONTACTS MATRIX */
    .contact-nature-group { margin-bottom: 15px; border: 1px solid var(--border); border-radius: 8px; overflow: hidden; background: #fff; }
    .contact-nature-head { background: #f1f3f5; padding: 10px 15px; font-weight: 800; font-size: 0.85rem; color: #495057; border-bottom: 1px solid var(--border); }
    .contact-row { display: grid; grid-template-columns: 1fr 120px 120px; align-items: center; border-bottom: 1px solid #f8f9fa; }
    .contact-desc { padding: 12px; font-size: 0.9rem; }
    .contact-opt { padding: 12px; text-align: center; cursor: pointer; border-left: 1px solid #f1f3f5; transition: 0.2s; height: 100%; display: flex; flex-direction: column; justify-content: center; }
    .contact-opt.selected { background: var(--sel); color: var(--pri); font-weight: 800; border-left: 2px solid var(--pri); }

    /* MULTI-FACTOR (WORKING CONDITIONS) */
    .sub-section{margin-top:20px; border:1px solid var(--border); border-radius:6px; padding:15px; background:#fafafa;}
    .sub-title { font-weight:800; color:var(--mute); margin-bottom:10px; font-size:0.7rem; text-transform:uppercase; letter-spacing:1px; }

    .rationale-accordion { margin-top: 15px; border: 1px solid var(--border); border-radius: 6px; background: #fdfdfd; }
    .rationale-accordion summary { padding: 12px; font-size: 0.85rem; font-weight: 700; color: var(--pri); cursor: pointer; list-style: none; }
    .rationale-text { width: 100%; padding: 10px; border: 1px solid #ced4da; border-radius: 4px; font-family: 'Georgia', serif; font-size: 1rem; box-sizing: border-box; resize: vertical; }

    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center; z-index: 1000; backdrop-filter: blur(3px); }
    .modal-content { background: white; width: 95%; max-width: 850px; max-height: 85vh; border-radius: 12px; display: flex; flex-direction: column; overflow: hidden; }
    .modal-body { padding: 30px; overflow-y: auto; white-space: pre-wrap; font-family: 'Georgia', serif; font-size: 1rem; line-height: 1.6; color: #2c3e50; }
    .pg-ref { color: var(--pri); font-weight: 800; font-size: 0.85rem; border-bottom: 2px solid var(--sel); padding-bottom: 10px; margin-bottom: 15px; display: block; }

    footer { position: fixed; bottom: 0; left: 0; width: 100%; background: white; border-top: 1px solid var(--border); padding: 15px 0; z-index: 200; box-shadow: 0 -4px 10px rgba(0,0,0,0.05); }
    .footer-inner { max-width: 900px; margin: 0 auto; padding: 0 15px; display: flex; justify-content: space-between; align-items: center; }

    @media print { .no-print { display: none !important; } footer { position: static; box-shadow: none; border-top: none; } .card { border: none; box-shadow: none; } }
</style>
</head>
<body>

<header class="no-print">
    <h1>Unit II Evaluator</h1>
    <div class="header-controls">
        <button class="action-btn" onclick="exportData()">ðŸ’¾ Save</button>
        <button class="action-btn" onclick="document.getElementById('fileInput').click()">ðŸ“‚ Load</button>
        <input type="file" id="fileInput" style="display:none" onchange="importData(this)">
    </div>
</header>

<div class="container" id="app-content"></div>

<div class="modal-overlay" id="guideModal" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header" style="padding:20px; border-bottom:1px solid #eee; display:flex; justify-content:space-between; align-items:center;">
            <h2 id="modalTitle" style="margin:0; font-size: 1.1rem; color: var(--pri);"></h2>
            <button onclick="closeModal()" style="background:none; border:none; font-size:1.5rem; cursor:pointer;">&times;</button>
        </div>
        <div class="modal-body" id="modalBody"></div>
    </div>
</div>

<footer class="no-print">
    <div class="footer-inner">
        <div><span class="input-label">Total Points</span><span id="totalPoints" style="font-size:1.5rem; font-weight:800; margin-left:10px;">0</span></div>
        <div><span class="input-label">Est. Group</span><span id="payGroup" style="font-size:1.5rem; font-weight:800; color:var(--pri); margin-left:10px;">-</span></div>
        <div class="btn-row">
            <button class="action-btn" onclick="prevStep()">Back</button>
            <button class="action-btn" style="background:var(--pri); color:white" onclick="nextStep()">Next Factor</button>
        </div>
    </div>
</footer>

<script>
const factors = [
    {
        id:'edu', t:'1. Education', pg:'Page 2',
        sum: "Measures the minimum level of formal education or institutional training required to do the job.",
        full: `EDUCATION\n\nDEGREE 1\nUndergraduate Degree or equivalent.\n\nDEGREE 2\nUndergraduate degree in specific skilled area or equivalent or an undergraduate degree and a diploma or apprenticeship in specific skilled area or equivalent.\n\nDEGREE 3\nGraduate degree in specific skilled area, or equivalent.\n\nNotes on Education:\n1. "Degree and Diploma" refer to successful completion of accredited educational program.\n2. "Equivalent" refers to formal training in a non-accredited or non-institutional setting (for example, an apprenticeship); or formal education not resulting in a degree or a diploma, (for example experiences with multiple programs in university).`,
        opts:[{p:13,t:"Degree 1",d:"Undergrad or equivalent."},{p:26,t:"Degree 2",d:"Specific Undergrad / Diploma / Apprenticeship."},{p:39,t:"Degree 3",d:"Specific Graduate Degree."}]
    },
    {
        id:'exp', t:'2. Experience', pg:'Page 3',
        sum: "Measures practical application of knowledge and delivery in learning environments.",
        full: `EXPERIENCE\n\nDEGREE 1\nUp to two years directly related experience with some experience in a post-secondary setting.\n\nDEGREE 2\nThree to four years directly related experience with some experience in post-secondary setting.\n\nDEGREE 3\nFive or more years directly related experience with some experience in a post-secondary setting.\n\nExperience Definition:\nThis factor serves as a scale of measurement for the amount of practical experience that an average individual having the appropriate theoretical knowledge, specific education and specialized training would require to be able to perform the job duties.\n\nDirectly related experience consists of two parts: (1) the practical application of the knowledge and skills required to do the job and (2) delivery of skills and knowledge to people in a learning environment.`,
        opts:[{p:20,t:"Degree 1",d:"Up to 2 years."},{p:40,t:"Degree 2",d:"3-4 years."},{p:60,t:"Degree 3",d:"5+ years."}]
    },
    {
        id:'comp', t:'3. Complexity/Judgement', pg:'Pages 4-5',
        sum: "Adherence to procedure vs requirement for analysis, creative thinking, and planning.",
        full: `PROBLEM SOLVING/COMPLEXITY/JUDGEMENT\n\nDEGREE 1\nLimited analysis, reasoning, problem solving, creativity or initiative is required. In many, but not all, cases, this may mean selecting the most appropriate course of action from a number of possible solutions, but assignments are generally standardized. Limited planning may be involved on the job. The job requires the application of established methods or procedures. Work may involve a choice of methods.\n\nDEGREE 2\nA moderate degree of analysis, reasoning, problem solving, creativity, or initiative is required. Situations provide some opportunity for standardized solutions and some requirement to recognize and creatively define problems and/or their practical solutions. There is usually a moderate degree of variation and variety in or from daily routines. A moderate degree of planning may be necessary. The job requires adapting established methods or procedures. Work involves a choice of methods or procedures.\n\nDEGREE 3\nInterpretative skill and ongoing, reasoning, problem solving, creativity, or initiative is required. This may require using logical, evaluative thinking to define problems, collect information, establish facts and form valid solutions. Situations are diverse although not unique and offer considerable opportunity for creativity and mental challenge. Substantial planning may be required. The job requires that changes be recommended to established methods or procedures. Work involves a choice of methods or procedures or sequence of operation.\n\nDEGREE 4\nComplex and highly developed analysis, reasoning, problem solving, creativity, or initiative is required as with new technologies. Situations are often unique and typically require a great degree of mental challenge. This includes the development of methods or procedures. Complex planning may be required.\n\nDEGREE 5\nThe job requires all of Degree 4 plus the recommendation of change to established policies.\n\nFACTOR NOTES:\n1. This factor deals with the range of choice of action which is within the scope of the job duties, and does not deal with the responsibility for decisions which is dealt with under the Responsibility/Accountability factor.\n2. Consider the initiative required in problem solving, analysis of situations and problems, the application of fundamental principles and the extent to which judgement must be exercised in deciding upon the appropriate choices of action.\n3. Evaluate the judgement permitted within the parameters and constraints of the position. No consideration is given to the capabilities of the incumbent.\n\nThis factor considers:\n- the extent to which the duties are performed through adherence to procedure, guidelines, predetermined routines, etc;\n- the degree of analysis and interpretation required to identify issues/problems and to recommend or carry out solutions;\n- creativity or ingenuity required on an ongoing basis;\n- the requirement to prioritize or plan work;\n- the requirement to display initiative and/or judgement;\n- the variety and diversity of problems and situations.\n\nPrioritizing is interpreted to mean arranging one's daily schedule; planning has a longer term connotation.\n\nDefinitions:\nLimited: Occasional requirement for decision making. Not an ongoing requirement beyond situations with standardized choices.\nModerate: Ongoing requirement for some decision making and thinking in a variety of duties.\nHigh degree: Ongoing, varied requirement to make decisions and think creatively. Searching for information used for the solution.\nComplex: Dealing with unique situations involving decision making and creative thinking. Developing solutions for problems occurring for the first time.`,
        opts:[{p:25,t:"Degree 1",d:"Limited analysis, standardized."},{p:50,t:"Degree 2",d:"Moderate analysis, choice of methods."},{p:75,t:"Degree 3",d:"Diverse situations, substantial planning."},{p:100,t:"Degree 4",d:"Complex analysis/Unique situations."},{p:125,t:"Degree 5",d:"Degree 4 + policy changes."}]
    },
    {
        id:'resp', t:'4. Responsibility', pg:'Pages 6-7',
        sum: "Answerability for actions. Budget size: Small-Moderate ($1.5k-$25k) vs Large Scale (>$25k).",
        full: `RESPONSIBILITY/ACCOUNTABILITY\n\nDEGREE 1: Responsible for overseeing the application of a department or studio policies and procedures during their shift.\n\nDEGREE 2: DEGREE I functions plus responsibility for performing a full range of duties related to a separate, limited access area or function. May include the signing of Time Sheets for Student Assistants.\n\nDEGREE 3: Performs all duties of Degrees I and II and is responsible for performing duties and functions related to a limited aspect of a separate open access area.\n\nDEGREE 4: Performs all duties of Degrees I and II and is responsible for performing a full range of duties (which may include researching cost of budget items) and all functions related to a separate open access area on a regular basis.\n\nDEGREE 5: Oversees a complete departmental area or specialized function of limited scope in an open access area. Assumes management responsibility for area in absence of supervisor. Responsibilities may include management of grants received to supplement budget or staffing needs.\n\nDEGREE 6: Oversees a complete departmental area or function with multiple functions. Assumes management responsibility for area in absence of supervisor and/or is responsible for preparation and presentation of small-scale budget.\n\nDEGREE 7: Responsible for the management of a complete departmental area or function of significant scope and is responsible for the preparation and presentation of large-scale budget.\n\nFactor Notes:\nDefined as the answerability for actions and the consequences thereof. This factor measures the impact or effect that the actions required by the position have on the achievement of NSCAD'S goals and its reputation.\n\nIt considers:\n- The freedom to act or deviate from assigned work;\n- The nature and scope of decisions made by the incumbent;\n- The likelihood of error and impact of errors;\n- Degree of responsibility for material resources;\n- Safeguarding confidential or valuable information;\n- Responsibility for the verification of the work of others;\n- Actions to prevent injury or harm to others.\n\nBudget Definitions:\n- Small to moderate scale = $1500 - 25,000\n- Large Scale: over $25,000\n\nOther Accountability Indicators:\n- Damage or loss involving equipment, supplies or property\n- Disruption or delay of service\n- Loss of time in detecting and correcting an error\n- Inaccuracy of reports or records\n- Morale of others\n- The seriousness of an error\n- Embarrassment to the University or Department`,
        opts:[{p:18,t:"Degree 1",d:"Overseeing shift policy."},{p:36,t:"Degree 2",d:"Full range, limited access area."},{p:54,t:"Degree 3",d:"Aspect of separate open access area."},{p:71,t:"Degree 4",d:"Full range open access (regular)."},{p:89,t:"Degree 5",d:"Oversees specialized function/area."},{p:107,t:"Degree 6",d:"Multiple functions / small budget."},{p:125,t:"Degree 7",d:"Significant scope / large budget."}]
    },
    {
        id:'supO', t:'5. Supervision Given', pg:'Pages 8-9',
        sum: "Monitoring SAs vs supervising Unit II staff. Includes planning, assigning work, and guidance.",
        full: `SUPERVISION OF OTHERS\n\nDEGREE I: No supervision of others. May be responsible for monitoring trained Student Assistants during their shift.\n\nDEGREE 2: Responsible for day to day monitoring and training of Student Assistants; periodically assumes some of the normal supervisory responsibilities over others. Responsible for supervision of 1 - 4 Student Assistants per semester.\n\nDEGREE 3: All of Degree 2 and responsible for the supervision of 5 or more Student Assistants or equivalent per semester OR Duties include recruiting, substantial training and dismissal of Student Assistants.\n\nDEGREE 4: The job requires the employee, on a continuing basis, to assume some of the normal supervisory responsibilities over others. This can include supervision of a limited term grant employee who works full time. Responsible for supervision of 1 Part Time Unit II Employee or equivalent who works for less than 15 hours per week.\n\nDEGREE 5: All of Degree 4 plus responsible for 2 or more Part Time Unit II Employees or equivalent who work for less than 15 hours per week.\n\nDEGREE 6: The job requires the employee, on a continuing basis, to assume the normal supervisory responsibilities over others. Assists in recruitment and hiring, evaluation and effective recommendation for discipline and/or dismissal of Unit II employees. Responsible for 1 Full Time Unit II Employee and 2 or more Part Time Unit II Employees or equivalent.\n\nDEGREE 7: All of Degree 6 plus responsible for 2 or more Full Time or equivalent Unit II Employees. Responsible for determining and recommending staffing needs for the area.\n\nSupervision of Others Notes:\nI. Consider hours per week worked by persons supervised and levels of training required (simple vs complex tasks).\nII. "Periodically" means intermittently but with reasonable regularity.\nIII. Supervisory responsibility must be a definitely established part of the job requirement.\nIV. "Normal" supervisory responsibilities must include a portion of each:\na) Planning, organizing, scheduling, and coordinating work.\nb) Assigning of work and/or personnel.\nc) Maintaining quality, accuracy, quantity of work.\nd) Giving advice, guidance, instructions, direction.\ne) Developing of work methods, work procedures, work standards.`,
        opts:[{p:18,t:"Degree 1",d:"No supervision."},{p:36,t:"Degree 2",d:"1-4 SAs."},{p:54,t:"Degree 3",d:"5+ SAs OR hiring duties."},{p:71,t:"Degree 4",d:"1 PT Unit II."},{p:89,t:"Degree 5",d:"2+ PT Unit II."},{p:107,t:"Degree 6",d:"1 FT and 2+ PT Unit II."},{p:125,t:"Degree 7",d:"2+ FT Unit II."}]
    },
    {
        id:'supR', t:'6. Supervision Rec\'d', pg:'Pages 10-11',
        sum: "Independence based on supervisor expertise and availability. Open access areas involve more conflict.",
        full: `SUPERVISION RECEIVED\n\nDEGREE 1: Supervisor skilled in area of expertise is available daily. Daily access for interpretation, troubleshooting, etc. Number of supervisors: one. Supervisor establishes set of routines.\n\nDEGREE 2: Supervisor skilled in area available daily for majority of tasks, but not for specific area of expertise. Weekly or occasional access. More than one faculty from same area.\n\nDEGREE 3: Employee does not have daily access to skilled supervisor. Occasionally required to research to provide solutions. Prioritizing by employee is necessary from time to time.\n\nDEGREE 4: Employee does not have daily access. Often required to research. Prioritizing necessary on a regular basis. Conflicting suggestions may require interpretation by employee based on needs of area.\n\nDEGREE 5: All of Degree 4 and employee works without supervision and sets policy based on the academic needs of the area.\n\nNotes and Definitions:\n- Factor should consider the number of persons who make demands on the area and the complexity of these demands.\n- Demands from faculty from different areas increase complexity.\n- Open access areas present potential conflicts due to varied clients.\n- Consider the physical location of the supervisor (ease of requesting assistance vs independent decision making).\n- Technicians in areas with only part-time or sessional faculty usually have more independence in setting policy based on academic needs.`,
        opts:[{p:15,t:"Degree 1",d:"Daily access, skilled supervisor."},{p:30,t:"Degree 2",d:"Weekly/occasional access."},{p:45,t:"Degree 3",d:"No daily access; research solutions."},{p:60,t:"Degree 4",d:"No daily access; prioritize regular basis."},{p:75,t:"Degree 5",d:"Works without supervision; sets policy."}]
    },
    {
        id:'cont', t:'7. Contacts', pg:'Pages 12-13', isMatrix: true,
        sum: "Nature and frequency of communication. Difficult nature = specialized formal training required.",
        full: `CONTACTS\n\nMeasures the contacts necessary in communicating with others, co-workers, public, or students in a tactful and harmonious manner.\n\nDEGREES 1-2: Basic verbal contacts where common courtesy and tact are required. Occasional (1) or Daily (2).\nDEGREES 3-4: Basic verbal and written contacts where tact and discretion are required for settled requests or complaints. Occasional (3) or Daily (4).\nDEGREES 5-6: Complex verbal/written exchange of routine information where tact and diplomacy are required for resolution of problems of a difficult or specialized nature. Occasional (5) or Daily (6).\nDEGREES 7-8: Complex or confidential exchange where human relations skills are required for influencing or persuading. Occasional (7) or Daily (8).\nDEGREES 9-10: Complex or confidential exchange. A major element of the job dealing with highly sensitive issues or negotiation. Occasional (9) or Daily (10).\n\nDefinitions:\n- "Difficult or specialized nature": subject area that is complex and typically requires specialized formal training or extensive experience to communicate meaningfully.\n- "Human relations skills": persuasion, influencing, empathy, sensitivity, and understanding of behaviour.\n- "Confidential": discussing Performance Review reports.`,
        matrix: [
            {n: "Basic Verbal", d: "Common courtesy and tact required.", o: 5, q: 10},
            {n: "Basic Verbal/Written", d: "Tact and discretion for requests or complaints.", o: 15, q: 20},
            {n: "Complex/Specialized", d: "Tact and diplomacy for resolution of specialized problems.", o: 25, q: 30},
            {n: "Complex/Confidential (Persuasion)", d: "Human relations skills for influencing or persuading.", o: 35, q: 40},
            {n: "Complex/Confidential (Negotiation)", d: "Highly sensitive issues or negotiation; major element of job.", o: 45, q: 50}
        ]
    },
    {
        id:'cond', t:'8. Working Conditions', pg:'Page 14', isMulti:true,
        sum: "Sum of environmental strain across five categories. Hazards capped based on Minor vs Major risks.",
        full: `WORKING CONDITIONS\n\nI. HAZARDS (Points range 0.5 to 3)\n- Occasional Minor: 0.5 pts. Mold, dust, older buildings. Risk of minor lost time.\n- Occasional Major: 1.0 pt. Airborne particles (fumes, smoke), toxic chemicals, dangerous machinery, electrical hazards, noise, vibrations. Risk of serious illness.\n- Frequent Minor: 2.0 pts.\n- Frequent Major: 3.0 pts.\n\nII. UNPLEASANT CONDITIONS\na) Few interruptions: 1 | b) Occasional: 2 | c) Frequent: 3\n\nIII. EXPOSURE\na) Occasional unpleasant staff: 1\nb) Routine encounters with upset staff: 2\nc) Routine encounters with upset staff AND general public: 3\n\nIV. SPACE\na) Private space: 1 | b) Access to private part-day: 2 | c) Public space all day: 3\n\nV. WORKING HOURS\na) Regular 9-5 M-F: 1\nb) Occasional eves/wknds or non-business regular shifts: 2\nc) Always non-business: 3`,
        subs:[
            {id:'haz',t:'I. Hazards (Points)',opts:[{v:0.5,t:"0.5 pts: Occas. Minor"},{v:1,t:"1.0 pt: Occas. Major"},{v:2,t:"2.0 pts: Freq. Minor"},{v:3,t:"3.0 pts: Freq. Major"}]},
            {id:'unp',t:'II. Interruptions',opts:[{v:1,t:"1 pt: Few"},{v:2,t:"2 pts: Occasional"},{v:3,t:"3 pts: Frequent"}]},
            {id:'exp',t:'III. Exposure',opts:[{v:1,t:"1 pt: Occas. Unpleasant"},{v:2,t:"2 pts: Routine Upset"},{v:3,t:"3 pts: Routine Staff/Public"}]}
        ]
    }
];

let cur = 0, scores = {}, rationales = {}, userData = { name: "", position: "", date: new Date().toLocaleDateString() };

function render() {
    const el = document.getElementById('app-content');
    if (cur >= factors.length) { renderSummary(el); return; }
    const f = factors[cur];
    
    let profile = cur === 0 ? `<div class="card">
        <div class="details-grid">
            <div><label class="input-label">Name</label><input type="text" class="input-field" value="${userData.name}" oninput="userData.name=this.value; save();"></div>
            <div><label class="input-label">Current Job Title</label><input type="text" class="input-field" value="${userData.position}" oninput="userData.position=this.value; save();"></div>
        </div>
    </div>` : "";

    let opts = "";
    if (f.isMatrix) {
        opts = f.matrix.map(row => `
            <div class="contact-nature-group">
                <div class="contact-nature-head">${row.n}</div>
                <div class="contact-row">
                    <div class="contact-desc">${row.d}</div>
                    <div class="contact-opt ${scores[f.id]===row.o?'selected':''}" onclick="setScore('${f.id}', ${row.o})">Occasional<br><small>${row.o} pts</small></div>
                    <div class="contact-opt ${scores[f.id]===row.q?'selected':''}" onclick="setScore('${f.id}', ${row.q})">Daily<br><small>${row.q} pts</small></div>
                </div>
            </div>`).join('');
    } else if (f.isMulti) {
        opts = f.subs.map(s => `<div class="sub-section"><div class="sub-title">${s.t}</div><div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">${s.opts.map(o => `<div class="opt-item ${scores[f.id+'_'+s.id]===o.v?'selected':''}" style="margin:0; text-align:center" onclick="setSubScore('${f.id}','${s.id}',${o.v})">${o.t}</div>`).join('')}</div></div>`).join('');
    } else {
        opts = f.opts.map(o => `<div class="opt-item ${scores[f.id]===o.p?'selected':''}" onclick="setScore('${f.id}',${o.p})"><span class="opt-score">${o.p} pts</span><strong>${o.t}</strong><br><small>${o.d}</small></div>`).join('');
    }

    el.innerHTML = profile + `
        <div class="card">
            <div class="factor-header">
                <h2 class="factor-title">${f.t}</h2>
                <div class="btn-row">
                    <button class="guide-btn" onclick="openGuide(${cur},'sum')">Summary</button>
                    <button class="guide-btn manual" onclick="openGuide(${cur},'full')">Full Manual Text</button>
                </div>
            </div>
            ${opts}
            <details class="rationale-accordion" ${rationales[f.id]?'open':''}>
                <summary>Rationale & Evidence</summary>
                <div style="padding:15px"><textarea class="rationale-text" rows="4" oninput="rationales['${f.id}']=this.value; save();" placeholder="Enter supporting evidence from current JD...">${rationales[f.id]||''}</textarea></div>
            </details>
        </div>`;
    window.scrollTo(0,0);
}

function setScore(id, v) { scores[id] = v; save(); updateFooter(); render(); }
function setSubScore(fid, sid, v) { scores[fid+'_'+sid] = v; save(); updateFooter(); render(); }
function getFactorTotal(f) { return f.isMulti ? f.subs.reduce((a,s)=>a+(scores[f.id+'_'+s.id]||0),0) : (scores[f.id]||0); }
function calcT() { return factors.reduce((a,f)=>a+getFactorTotal(f),0); }
function updateFooter() { let t = calcT(); document.getElementById('totalPoints').innerText = t.toFixed(1); }

function renderSummary(el) {
    el.innerHTML = `<div class="card"><h2>Evaluation Summary</h2><table style="width:100%;border-collapse:collapse">${factors.map(f=>`<tr><td style="padding:10px;border-bottom:1px solid #eee"><strong>${f.t}</strong></td><td style="text-align:right; font-weight:700">${getFactorTotal(f)} pts</td></tr><tr><td colspan="2" style="padding:0 0 15px 10px;color:#666;font-size:0.85rem"><em>${rationales[f.id]||'No evidence listed.'}</em></td></tr>`).join('')}</table><button class="action-btn" onclick="window.print()" style="width:100%;margin-top:20px;background:var(--pri);color:white">Print PDF Report</button></div>`;
}

function openGuide(i, type) {
    document.getElementById('modalTitle').innerText = factors[i].t;
    document.getElementById('modalBody').innerHTML = `<span class="pg-ref">Manual Reference: ${factors[i].pg}</span>` + (type === 'full' ? factors[i].full : factors[i].sum);
    document.getElementById('guideModal').style.display = 'flex';
}
function closeModal() { document.getElementById('guideModal').style.display = 'none'; }
function save() { localStorage.setItem('nscad_verbatim_classic_v1', JSON.stringify({scores, rationales, userData})); }
function nextStep() { if(cur<factors.length) { cur++; render(); } }
function prevStep() { if(cur>0) { cur--; render(); } }

function exportData() { let b = new Blob([JSON.stringify({ scores, rationales, userData })], {type:"text/plain"}); let a = document.createElement("a"); a.href=URL.createObjectURL(b); a.download=`Eval_${userData.name||'Member'}.nate`; a.click(); }
function importData(i) { let r = new FileReader(); r.onload=(e)=>{ let d=JSON.parse(e.target.result); scores=d.scores; rationales=d.rationales; userData=d.userData; cur=0; render(); updateFooter(); }; r.readAsText(i.files[0]); }

window.onload = () => {
    const saved = localStorage.getItem('nscad_verbatim_classic_v1');
    if(saved) { const d = JSON.parse(saved); scores=d.scores; rationales=d.rationales; userData=d.userData; }
    render(); updateFooter();
};
</script>
</body>
</html>
